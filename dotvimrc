set nocompatible
call pathogen#infect()

filetype plugin indent on

syntax enable
set background=dark
if has('gui_running')
    colorscheme solarized 
    set colorcolumn=80
    set cursorline

    if has('transparency')
        set transparency=4
    endif
endif

set autoindent
set cindent
set foldmethod=manual
set number
set ruler
set backupdir=~/.saves
set noswapfile
set expandtab
set smartindent
set softtabstop=4
set tabstop=4
set shiftwidth=4
set noerrorbells
set visualbell
set vb
set hlsearch
set switchbuf=usetab

set mouse=a
set ttymouse=xterm2
set guioptions-=T
set guifont=Droid\ Sans\ Mono\ 10

map <C-t> :tabnew<cr>
map <C-tab> :tabnext<cr>
map <C-S-tab> :tabprevious<cr>

set wildignore+=**/node_modules,**/node_modules/*,**/target,**/target/*,coverage/*,*.log,test/output

let mapleader=","
"let g:CommandTAcceptSelectionTabMap='<CR>'
let NERDTreeRespectWildIgnore=1
let NERDTreeShowHidden=1
let NERDTreeIgnore=['\.pyc$', '__pycache__']

map <leader>f :CommandT<cr>
map <leader>a :NERDTreeToggle<cr>
map <leader>b :Gblame<cr>
map <leader>d :Gdiff<cr>
map <leader>t :tag<cr>

" Setup project/team-specific configurations
function! SetupEnvironment()
    let l:path = expand('%:p')
    " MapQuest
    if l:path =~ '/Users/ashamblin14/workspace'
        if &filetype == "javascript"
            setlocal tabstop=2 softtabstop=2 shiftwidth=2
        endif
        if &filetype == "less"
            setlocal tabstop=2 softtabstop=2 shiftwidth=2
        endif
        if &filetype == "css"
            setlocal tabstop=2 softtabstop=2 shiftwidth=2
        endif
        if &filetype == "html"
            setlocal tabstop=2 softtabstop=2 shiftwidth=2
        endif
    endif
endfunction

function! RestoreRegister()
    let @" = s:restore_reg
    return ''
endfunction

function! s:Repl()
    let s:restore_reg = @"
    return "p@=RestoreRegister()\<cr>"
endfunction

autocmd FileType make setlocal noexpandtab

au BufNewFile,BufRead *.js set filetype=javascript
au BufNewFile,BufRead *.json set filetype=javascript
au BufNewFile,BufRead Podfile,*.podspec set filetype=ruby
au BufNewFile,BufRead /usr/local/nginx/conf/* set filetype=nginx
au BufNewFile,BufRead *.less set filetype=less
au BufNewFile,BufRead *.md,*.txt setlocal textwidth=80
au BufWritePost *.py call Flake8()
au BufWritePost *.js :JSHint
au BufWritePost *.ts :TSLint

au BufNewFile,BufRead *.dat setlocal noexpandtab
au BufNewFile,BufRead *.jade setlocal noexpandtab

au BufNewFile,BufRead * call SetupEnvironment()

vmap <silent> <expr> p <sid>Repl()

let localrc = expand("~/.vim.local")
if filereadable(localrc)
    so ~/.vim.local
endif
